# ===============================================================
# sg-units.rds
#
# Project: Revolution Now
#
# Created by dsicilia on 2022-02-12.
#
# Description: RDS definitions for the units save game state.
#
# ===============================================================
# Revolution Now
include "colony-id.hpp"
include "coord.hpp"
include "unit-id.hpp"
include "unit.hpp"

# C++ standard library
include "<unordered_map>"

namespace "rn"

# These pertain to units who are owned by either the high seas or
# by europe view (e.g., in port, on the dock, etc.);
sumtype.UnitHarborViewState {
  # For ships that are venturing to europe. `percent` starts from
  # 0 and goes to 1.0 at arrival. This means that the value
  # should never actually assume a value of 1.0, because as soon
  # as it does, the state is transitioned to in_port.
  outbound {
    percent 'double',
  },

  # For ships that are traveling from europe to the new world.
  # `percent` starts from 0 and goes to 1.0 at arrival. This
  # means that the value should never actually assume a value of
  # 1.0, because as soon as it does, the state is transitioned to
  # the map.
  inbound {
    percent 'double',
  },

  # If a ship is in this state then it is in port (shown in the
  # "in port" box) whereas for land units this means that they
  # are on the dock.
  in_port {},

  _features { equality, validation }
}

sumtype.UnitOwnership {
  free {},
  world {
    coord 'Coord',
  },
  cargo {
    holder 'UnitId',
  },
  harbor {
    st 'UnitHarborViewState_t',
  },
  colony {
    id 'ColonyId',
  },
}

struct.UnitState {
  unit 'Unit',
  ownership 'UnitOwnership_t',
}

namespace "rn.wrapped"

struct.UnitsState {
  next_unit_id 'int',
  units 'std::unordered_map<UnitId, UnitState>',

  _features { equality, validation }
}
