# ===============================================================
# colony.rds
#
# Project: Revolution Now
#
# Created by dsicilia on 2022-06-06.
#
# Description: Config info for colonies (non-production).
#
# ===============================================================
# gs
include "ss/colony-enums.rds.hpp"
include "ss/unit-type.rds.hpp"
include "ss/fathers.rds.hpp"
include "ss/commodity.rds.hpp"

# gfx
include "gfx/pixel.hpp"

# refl
include "refl/enum-map.hpp"

# cdr
include "cdr/ext-base.hpp"
include "cdr/ext-builtin.hpp"
include "cdr/ext-std.hpp"

# base
include "base/maybe.hpp"

# C++ standard library
include "<string>"
include "<unordered_map>"

namespace "rn.config.colony"

struct.warehouses {
  # Maximum amount of non-food quantity of a commodity that can
  # be stored in a colony with no warehouses.
  default_max_quantity 'int',

  # Maximum amount of non-food quantity of a commodity that can
  # be stored in a colony with a warehouse.
  warehouse_max_quantity 'int',

  # Maximum amount of non-food quantity of a commodity that can
  # be stored in a colony with a warehouse expansion.
  warehouse_expansion_max_quantity 'int',

  # The original game doesn't seem to impose a limit on the
  # amount of food that can be stored. This is to allow exceeding
  # 100 without a warehouse in order to get to 200 which is
  # needed to create a new colonist (and creating a new colonist
  # at 100 made it too easy).
  commodities_with_warehouse_limit 'refl::enum_map<e_commodity, bool>',

  _features { validation, equality }
}

struct.outdoors {
  job_names 'refl::enum_map<e_outdoor_job, std::string>',
}

# How many of each are needed for a given construction project.
struct.construction_requirements {
  hammers 'int',
  tools   'int',

  # If a building is required for this. In that case, the
  # building itself and any higher building in the same slot will
  # suffice as well.
  required_building 'base::maybe<e_colony_building>',

  # Colonies with a population less than this will not see the
  # option to build this item.
  minimum_population 'int',

  # Is a founding father required for this building.
  required_father 'base::maybe<e_founding_father>',

  # Does this item require an adjacent water tile. Note that the
  # water tile does not have to have ocean access, but must be
  # immediately adjacent in any direction.
  requires_water 'bool',

  _features { validation, equality }
}

struct.colors {
  # In addition to a black shadow behind the unit (to the left),
  # we render a one-pixel "glow" on the right side of the unit
  # for ease of discerning the unit over the background terrain.
  outdoor_unit_glow_color 'gfx::pixel',

  # Units that are on a lighter background (such as indoor units)
  # that don't need as pronounced of a shadow color will get this
  # shadow color.
  unit_shadow_color_light 'gfx::pixel',
}

namespace "rn"

# Note that this config is for non-production related things. For
# production-related things there is a dedicated config file.
struct.config_colony_t {
  warehouses 'config::colony::warehouses',

  food_for_creating_new_colonist 'int',

  # The maximum number of people that be placed in each (indoor)
  # colony building.
  max_workers_per_building 'int',

  # When a colony is founded it will get this set of buildings
  # for free.
  initial_colony_buildings 'std::unordered_set<e_colony_building>',

  outdoors 'config::colony::outdoors',

  # All buildings are theoretically buildable, and this will
  # specify how many hammers and tools are needed for each.
  requirements_for_building 'refl::enum_map<e_colony_building, config::colony::construction_requirements>',

  # This gives the list of units that are buildable in a colony
  # as well as how many hammers and tools are needed for each.
  requirements_for_unit 'refl::enum_map<e_unit_type, base::maybe<config::colony::construction_requirements>>',

  building_display_names 'refl::enum_map<e_colony_building, std::string>',

  colors 'config::colony::colors',

  _features { validation, equality }
}

config.colony {}
