# ===============================================================
# natives.rds
#
# Project: Revolution Now
#
# Created by dsicilia on 2022-10-29.
#
# Description: Rds definitions for the natives module.
#
# ===============================================================
# config
include "config/tile-enum.rds.hpp"

# ss
include "ss/colony-enums.rds.hpp"
include "ss/native-enums.rds.hpp"

# cdr.
include "cdr/ext-base.hpp"
include "cdr/ext-builtin.hpp"
include "cdr/ext-std.hpp"

# gfx
include "gfx/cartesian.hpp"
include "gfx/pixel.hpp"

# refl
include "refl/enum-map.hpp"

# C++ standard library
include "<string>"

namespace "rn"

# Size of the land around the dwelling owned by a dwelling.
enum.e_dwelling_radius {
  small,
  large,
}

# This indicates how primitive or advanced a tribe is. In most
# ways, the OG seems to treat all of the semi-nomadic tribes the
# same and all of the agrarian tribes the same, but it differen-
# tiates between the Aztec and Inca; the Inca is considered a bit
# more advanced.
enum.e_native_level {
  semi_nomadic,
  agrarian,
  civilized_aztec,
  civilized_inca,
}

namespace "rn.config.natives"

struct.UnitType {
  movement_points 'int',
  combat 'int',
  tile 'e_tile',
}

struct.DwellingType {
  radius 'e_dwelling_radius',
  name_singular 'std::string',
  name_plural 'std::string',
}

struct.Tribe {
  name_singular 'std::string',
  name_plural 'std::string',
  name_posessive 'std::string',

  level 'e_native_level',

  max_population 'int',
  max_population_capital 'int',

  dwelling_tile 'e_tile',
  flag_color 'gfx::pixel',
}

struct.Alarm {
  # If the effective alarm of a dwelling is larger than this then
  # they will not teach. Note that this is only relevant when not
  # at war (when at war, they will never teach).
  max_dwelling_alarm_for_teaching 'int',
}

struct.DwellingExpertise {
  # When we are computing the dwelling expertise we need to com-
  # pute the production quantity of each outdoor job on each sur-
  # rounding tile. This map determines whether we should do that
  # assuming an expert (true) or a free colonist (false). This
  # makes a difference because it will change the relative pro-
  # portions of produced quantities from the various jobs and
  # thus change the weights.
  production_from_expert 'refl::enum_map<e_outdoor_job, bool>',

  # After the base weights are computed based on production vol-
  # ume, they will be further scaled by these values to change
  # the probability of the various outcomes.
  scale_factors 'refl::enum_map<e_native_level, refl::enum_map<e_native_skill, double>>',

  # After all of the outdoor production-based weights are com-
  # puted the probability of the fur trading and scouting exper-
  # tises will still be zero because they are not derived from
  # outdoor production. So fur trading and scouting weights will
  # be generated that are equal to the weight of fur trapping
  # multiplied by these fractions.
  fur_trader_fraction 'double',

  # After all of the production-based weights are computed the
  # probability of the scouting expertise will still be zero be-
  # cause it is not derived from production. So the a scouting
  # weight will be generated that is equal to T*F*S, where T is
  # the sum of all weights, F is the fraction ([0,1]) of sur-
  # rounding tiles that are forested (since the OG seems to only
  # teaching scouting when the dwelling is surrounded one or more
  # forested tiles) and S is the below scale factor that will
  # normally be larger than one.
  seasoned_scout_scale 'double',
}

namespace "rn"

struct.config_natives_t {
  unit_types 'refl::enum_map<e_native_unit_type, config::natives::UnitType>',

  dwelling_types 'refl::enum_map<e_native_level, config::natives::DwellingType>',

  tribes 'refl::enum_map<e_tribe, config::natives::Tribe>',

  # Each camp/village has a couple pixels of color (matching the
  # flag color of the tribe) to indicate their tribe. They can be
  # single pixels, lines, or rects. These give the rects that
  # should be filled in relative to the upper left corner of the
  # camp/village sprite.
  flag_rects 'refl::enum_map<e_native_level, std::vector<gfx::rect>>',

  # Describes behaviors having to do with native alarm level.
  # Note that there is dwelling-level alarm and tribal alarm, and
  # the names will specify which one is being referred to.
  alarm 'config::natives::Alarm',

  # Configures how each dwelling is assigned an expertise for
  # teaching.
  dwelling_expertise 'config::natives::DwellingExpertise',
}

config.natives {}
