# ===============================================================
# natives.rds
#
# Project: Revolution Now
#
# Created by dsicilia on 2022-10-29.
#
# Description: Rds definitions for the natives module.
#
# ===============================================================
# config
include "config/tile-enum.rds.hpp"

# ss
include "ss/native-enums.rds.hpp"

# cdr.
include "cdr/ext-base.hpp"
include "cdr/ext-builtin.hpp"
include "cdr/ext-std.hpp"

# gfx
include "gfx/cartesian.hpp"
include "gfx/pixel.hpp"

# refl
include "refl/enum-map.hpp"

# C++ standard library
include "<string>"

namespace "rn"

# Size of the land around the dwelling owned by a dwelling.
enum.e_dwelling_radius {
  small,
  large,
}

enum.e_native_civilized {
  semi_nomadic,
  agrarian,
  civilized,
}

enum.e_dwelling_type {
  camp,
  village,
  city,
}

namespace "rn.config.natives"

struct.UnitType {
  movement_points 'int',
  combat 'int',
  tile 'e_tile',
}

struct.DwellingType {
  radius 'e_dwelling_radius',
  name_singular 'std::string',
  name_plural 'std::string',
}

struct.Tribe {
  name_singular 'std::string',
  name_plural 'std::string',
  name_posessive 'std::string',

  civilized 'e_native_civilized',
  dwelling_type 'e_dwelling_type',

  max_population 'int',
  max_population_capital 'int',

  dwelling_tile 'e_tile',
  flag_color 'gfx::pixel',
}

struct.Alarm {
  # If the effective alarm of a dwelling is larger than this then
  # they will not teach. Note that this is only relevant when not
  # at war (when at war, they will never teach).
  max_dwelling_alarm_for_teaching 'int',
}

struct.DwellingExpertise {
  # The tribe must have at least this level in order to teach
  # this skill. If it is nothing then it cannot be taught.
  minimum_level 'refl::enum_map<e_unit_activity, base::maybe<e_native_civilized>>',

  # After the base weights are computed based on production vol-
  # ume, they will be further scaled by these values to change
  # the probability of the various outcomes.
  scale_factors 'refl::enum_map<e_unit_activity, double>',

  # After all of the outdoor production-based weights are com-
  # puted the probability of the fur trading expertise will still
  # be zero because it is not derived from outdoor production. So
  # a fur trading weight will be generated that is equal to the
  # weight of fur trapping multiplied by this fraction, which
  # should be smaller than one.
  fur_trader_fraction 'double',

  # After all of the production-based weights are computed the
  # probability of the scouting expertise will still be zero be-
  # cause it is not derived from production. So the a scouting
  # weight will be generated that is equal to the total weights
  # multiplied by this fraction, which should be smaller than
  # one. Roughly speaking, this is the percentage of dwellings
  # that will teach this skill.
  seasoned_scout_fraction 'double',
}

namespace "rn"

struct.config_natives_t {
  unit_types 'refl::enum_map<e_native_unit_type, config::natives::UnitType>',

  dwelling_types 'refl::enum_map<e_dwelling_type, config::natives::DwellingType>',

  tribes 'refl::enum_map<e_tribe, config::natives::Tribe>',

  # Each camp/village has a couple pixels of color (matching the
  # flag color of the tribe) to indicate their tribe. They can be
  # single pixels, lines, or rects. These give the rects that
  # should be filled in relative to the upper left corner of the
  # camp/village sprite.
  flag_rects 'refl::enum_map<e_dwelling_type, std::vector<gfx::rect>>',

  # Describes behaviors having to do with native alarm level.
  # Note that there is dwelling-level alarm and tribal alarm, and
  # the names will specify which one is being referred to.
  alarm 'config::natives::Alarm',

  # Configures how each dwelling is assigned an expertise for
  # teaching.
  dwelling_expertise 'config::natives::DwellingExpertise',
}

config.natives {}
